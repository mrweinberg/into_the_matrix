# AGENTS.md - Architecture Guide for AI Agents

This document provides a comprehensive guide to the Into The Matrix (ITM) codebase architecture, designed to help AI agents quickly understand and navigate the project.

## Project Summary

ITM is a Magic: The Gathering fan set with two main components:
1. **Art Generation Pipeline** - Node.js scripts that generate AI artwork via Google Gemini API
2. **Interactive Gallery App** - Vue 3 SPA for browsing cards, simulating drafts/sealed, and printing proxies

## Tech Stack

| Layer | Technology |
|-------|------------|
| Art Generation | Node.js + Google Gemini AI API |
| Frontend | Vue 3 (Composition API with `<script setup>`) |
| State Management | Pinia |
| Build Tool | Vite |
| Styling | CSS with CSS Variables (Matrix green theme) |
| Icons | Mana Font CDN for MTG mana symbols |

## Directory Structure

```
/
├── MTG INTO THE MATRIX.txt    # SOURCE OF TRUTH - all card designs and mechanics
├── generate_matrix.mjs        # AI art generation script (Gemini)
├── generate_data.mjs          # Card data JSON generator (Parses text file)
├── resize_art.mjs             # Image resizing script (Ensures 4:3 aspect ratio)
├── fix_syntax.mjs             # Utility to standardize magic syntax
├── artOverrides.json          # Per-card art prompt customizations
├── public/cards/              # CONSOLIDATED card artwork (PNG files)
│
├── src/                       # Vue 3 application
│   ├── main.js                # App entry point
│   ├── App.vue                # Root component
│   │
│   ├── data/                  # Static JSON data (generated by generate_data.mjs)
│   │   ├── cards.json         # All card data
│   │   ├── setInfo.json       # Set metadata and stats
│   │   └── notes.json         # Design notes
│   │
│   ├── stores/
│   │   └── cardStore.js       # Pinia store - card data access
│   │
│   ├── composables/           # Reusable logic (Vue Composition API)
│   │   ├── useFilters.js      # filtering logic
│   │   ├── useDraft.js        # 3-pack draft simulation + Bots
│   │   ├── useDeckBuilder.js  # Pool/deck management
│   │   ├── usePlaytest.js     # Playtesting zones (Hand, Battlefield)
│   │   └── useCardNotes.js    # Per-card user notes
│   │
│   ├── utils/
│   │   ├── cardUtils.js       # Color, CMC, Sorting criteria
│   │   ├── boosterLogic.js    # Pack generation algorithm
│   │   └── draftBots.js       # Bot drafting logic
│   │
│   ├── components/
│   │   ├── cards/             # Card rendering (CardItem.vue)
│   │   ├── dashboard/         # Main UI
│   │   ├── deck/              # Deck Builder & Stats
│   │   ├── filters/           # Filter controls
│   │   └── modals/            # DraftModal, SealedModal, etc.
│   │
│   └── assets/styles/         # Global CSS (print.css, cards.css)
│
└── dist/                      # Build output
```

## Key Architectural Decisions

### 1. Source of Truth
**Concept**: `MTG INTO THE MATRIX.txt` is the single source of truth.
**Workflow**:
1. Edit `MTG INTO THE MATRIX.txt` to change card text/stats.
2. Run `npm run generate-data` to update JSON.
3. Frontend automatically reflects changes.

### 2. Art Pipeline
**Concept**: Images are generated, resized to 4:3, and stored in `public/cards`.
**Workflow**:
1. `generate_matrix.mjs` generates raw images from card text + `artOverrides.json`.
2. `resize_art.mjs` ensures all images adhere to 4:3 aspect ratio (using Gemini/Imagen).
3. `fix_creature_refs.mjs` and `fix_syntax.mjs` ensure text consistency before generation.

### 3. Frontend Architecture
- **Composables**: Logic lives in `src/composables/`.
- **Modals**: Orchestrated in `App.vue` or specific parent views.
- **Deck Building**: Shared `DeckBuilder.vue` component used in Draft and Sealed.
- **Printing**: Uses CSS `@media print` and a teleported `.print-only-container`.

## Key Files for Agents

| Task | Primary Files |
|------|---------------|
| **Add/Edit Card** | `MTG INTO THE MATRIX.txt` then run `npm run generate-data` |
| **Fix Syntax** | `fix_syntax.mjs`, `fix_creature_refs.mjs` |
| **Edit Art Prompts** | `artOverrides.json` |
| **Logic** | `src/utils/boosterLogic.js`, `src/composables/useDraft.js` |
| **UI/Styling** | `src/components/cards/CardItem.vue`, `src/assets/styles/cards.css` |

## State Management

- **cardStore.js**: Loads `cards.json` once. Provides efficient lookups.
- **useFilters.js**: Manages complex filtering state (Colors, Types, Rarity).
- **useDraft.js**: Manages draft state, packs, and Bot behavior.
